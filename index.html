<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <title>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>üõí</text></svg>">
  <script>
    window.FIREBASE_CONFIG = {
      apiKey: "AIzaSyBT5IENDVv97PhJGW8mN6NGWMvRPUJtjW0",
      authDomain: "products-list-fdeea.firebaseapp.com",
      databaseURL: "https://products-list-fdeea-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "products-list-fdeea",
      storageBucket: "products-list-fdeea.firebasestorage.app",
      messagingSenderId: "321603427183",
      appId: "1:321603427183:web:6cf0386223f5eb3a3de69a",
      measurementId: "G-MGXVPPZMD5"
    };
  </script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <style>
    :root{
      --bg:#f0e6ff;
      --card:#ffffff;
      --ink:#1f2937;
      --muted:#6b7280;
      --accent-start:#ff7aa8;
      --accent-end:#f6c14d;
      --brand:#7c3aed;
      --led-off:#ef4444;       /* –ö–†–ê–°–ù–´–ô: –Ω–µ—Ç –ø—Ä–æ–¥—É–∫—Ç–∞ */
      --led-on:#22c55e;        /* –ó–ï–õ–Å–ù–´–ô: –ø—Ä–æ–¥—É–∫—Ç –≤–∑—è—Ç */
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;font:16px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans','Helvetica Neue',Arial,'Apple Color Emoji','Segoe UI Emoji';color:var(--ink);background:radial-gradient(1300px 900px at 80% -100px,#fff 0,#f7ecff 35%,var(--bg) 100%)}
    .wrap{max-width:980px;margin:40px auto;padding:0 16px}
    .banner{display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:space-between}
    h1{margin:.2em 0 0;font-size:clamp(28px,4.2vw,48px);line-height:1.05;letter-spacing:.5px;text-transform:uppercase}
    .sub{color:var(--muted);font-size:14px}
    .card{position:relative;margin-top:20px;background:var(--card);border-radius:28px;padding:22px 18px 18px;box-shadow:0 10px 25px rgba(124,58,237,.25)}
    .card:after{content:"";position:absolute;inset:-1px;border-radius:inherit;pointer-events:none;box-shadow:inset 0 0 0 2px rgba(0,0,0,.04)}

    .toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:2px 2px 14px}
    .toolbar .search{flex:1 1 260px;display:flex;align-items:center;gap:8px;background:#f3f4f6;border-radius:14px;padding:10px 12px}
    .toolbar input[type="search"]{border:0;background:transparent;outline:0;width:100%;font-size:15px}
    button{appearance:none;border:0;background:linear-gradient(135deg,var(--accent-start),var(--accent-end));color:#fff;font-weight:700;padding:10px 14px;border-radius:14px;cursor:pointer;box-shadow:0 10px 20px rgba(0,0,0,.15);transition:transform .06s ease}
    button:hover{transform:translateY(-1px)}
    button.secondary{background:#f3f4f6;color:#111;font-weight:600;box-shadow:none}

    .grid{display:grid;grid-template-columns:1fr;gap:4px}
    @media (min-width:700px){.grid{grid-template-columns:1fr 1fr}}

    /* –≠–ª–µ–º–µ–Ω—Ç —Å–ø–∏—Å–∫–∞ */
    .item{display:flex;align-items:center;gap:12px;padding:8px 10px;border-radius:12px;background:#fff;box-shadow:0 1px 0 rgba(0,0,0,.04)}
    .item[draggable="true"]{cursor:grab}
    .item.dragging{opacity:.6}
    .handle{font-size:18px;line-height:1;cursor:grab;user-select:none;opacity:.6}
    .name{font-weight:800;letter-spacing:.2px;flex:1}
    .item input{position:absolute;opacity:0;pointer-events:none}
    .switch{position:relative;width:46px;height:26px;background:var(--led-off);border-radius:9999px;box-shadow:inset 0 0 0 2px rgba(0,0,0,.05);transition:background .2s, box-shadow .2s}
    .switch::before{content:"";position:absolute;top:3px;left:3px;width:20px;height:20px;border-radius:50%;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.25);transition:transform .2s}
    .item input:checked + .switch{background:var(--led-on); box-shadow:0 0 10px rgba(34,197,94,.6), 0 0 22px rgba(34,197,94,.35)}
    .item input:checked + .switch::before{transform:translateX(20px)}

    .del{background:#fee2e2;color:#991b1b;border:0;border-radius:10px;padding:6px 8px;font-weight:700;cursor:pointer}
    .del:hover{background:#fecaca}

    form.add{display:flex;gap:8px;flex-wrap:wrap;margin:6px 2px 10px}
    form.add input{flex:1 1 220px;border:0;background:#f3f4f6;border-radius:14px;padding:10px 12px;font-size:15px;outline:0}

    .footer{display:flex;justify-content:space-between;align-items:center;margin-top:12px;color:var(--muted);font-size:13px}

    .toast{position:fixed;left:50%;bottom:22px;transform:translateX(-50%);background:#111;color:#fff;padding:10px 14px;border-radius:12px;opacity:0;pointer-events:none;transition:opacity .2s, transform .2s;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .toast.show{opacity:1;transform:translateX(-50%) translateY(-2px)}
    @media print{.banner,.toolbar,form.add,.footer{display:none}.card{box-shadow:none;border:0}body{background:#fff}}
  /* –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –±–ª–æ–∫–∞—Ö –∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –¥–∞–±–ª-—Ç–∞–ø –∑—É–º/–ø–∏–Ω—á */
    .item, .handle, .switch, .del, .toolbar button, .grid{
      -webkit-user-select:none; user-select:none; -ms-user-select:none; -webkit-touch-callout:none; touch-action:manipulation;
    }
    button, .item, .switch, .handle, .del{ -webkit-tap-highlight-color: transparent; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="banner">
      <h1>–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</h1>
      <div class="sub">–¢—É–º–±–ª–µ—Ä –∑–µ–ª—ë–Ω—ã–π ‚Äî –±–µ—Ä—ë–º; –∫—Ä–∞—Å–Ω—ã–π ‚Äî –Ω–µ—Ç. –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –º–æ–≥—É—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Firebase (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å).</div>
    </div>

    <div class="card" role="region" aria-label="–°–ø–∏—Å–æ–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤">
      <div class="toolbar">
        <div class="search" role="search">üîé
          <input id="q" type="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–ø–∏—Å–∫—É‚Ä¶ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–æ–ª–æ–∫–æ)" autocomplete="off" />
        </div>
        <button class="secondary" id="btn-all">–í—ã–¥–µ–ª–∏—Ç—å –≤—Å—ë</button>
        <button class="secondary" id="btn-clear">–°–±—Ä–æ—Å–∏—Ç—å</button>
        <button class="secondary" id="btn-sort" title="–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç –ê –¥–æ –Ø">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ê‚Üí–Ø</button>
        <button id="btn-copy" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–º–µ—á–µ–Ω–Ω—ã–µ">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        <button id="btn-share" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–ø–∏—Å–∫–æ–º">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</button>
      </div>

      <div id="list" class="grid" aria-live="polite"></div>

      <form class="add" id="add-form">
        <input id="add-input" type="text" minlength="2" maxlength="40" placeholder="–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π –ø—Ä–æ–¥—É–∫—Ç‚Ä¶" />
        <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
      </form>

      <div class="footer">
        <span id="counter">0 –≤—ã–±—Ä–∞–Ω–æ</span>
        <span id="syncstate">–†–µ–∂–∏–º: –ª–æ–∫–∞–ª—å–Ω—ã–π</span>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script>
    // ====== –ö–æ–Ω—Ñ–∏–≥ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ======
    const ROOM = new URLSearchParams(location.search).get('room') || 'public';
    const REMOTE_ENABLED = typeof window.FIREBASE_CONFIG === 'object' && window.FIREBASE_CONFIG !== null;

    // ===== –î–∞–Ω–Ω—ã–µ =====
    const STORAGE_KEY = 'magnet-list-v3';
    const DEFAULT_ITEMS = [
      '–ê–ø–µ–ª—å—Å–∏–Ω—ã','–ë–∞–Ω–∞–Ω—ã','–í–∏–Ω–æ–≥—Ä–∞–¥','–í–æ–¥–∞','–ì—Ä–∏–±—ã','–ô–æ–≥—É—Ä—Ç','–ö–∞—Ä—Ç–æ—Ñ–µ–ª—å','–ö–µ—Ç—á—É–ø','–ö–æ—Ñ–µ','–ö–æ–ª–±–∞—Å–∞',
      '–ö–∞—à–∞','–ö—É—Ä–∏—Ü–∞','–õ—É–∫','–ú–∞–∫–∞—Ä–æ–Ω—ã','–ú–∞—Å–ª–æ','–ú–∞–π–æ–Ω–µ–∑','–ú—ë–¥','–ú–æ–ª–æ–∫–æ','–ú—è—Å–æ','–û–≥—É—Ä—Ü—ã',
      '–ü–µ—Ä–µ—Ü','–ü–µ–ª—å–º–µ–Ω–∏','–ü–∏–≤–æ','–ü–æ–º–∏–¥–æ—Ä—ã','–†–∏—Å','–†—ã–±–∞','–°–∞—Ö–∞—Ä','–°–º–µ—Ç–∞–Ω–∞','–°–ª–∏–≤–∫–∏','–°–æ–ª—å',
      '–°–æ–∫','–°—ã—Ä','–°—ã—Ä–Ω—ã–π —Å–æ—É—Å','–¢–≤–æ—Ä–æ–≥','–ß–∞–π','–ß–µ—Å–Ω–æ–∫','–®–æ–∫–æ–ª–∞–¥','–•–ª–µ–±','–Ø–±–ª–æ–∫–∏','–Ø–π—Ü–∞'
    ];

    function loadState(){
      try{
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY));
        if(data && Array.isArray(data.items)) return data;
      }catch(e){}
      return {items: DEFAULT_ITEMS.map(name => ({name, checked:false}))};
    }
    let state = loadState();
    function saveLocal(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }

    // ===== Firebase (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ) =====
    let ref = null;
    if(REMOTE_ENABLED){
      try{
        const app = firebase.initializeApp(window.FIREBASE_CONFIG);
        const db = firebase.database();
        ref = db.ref('lists/'+ROOM);
        document.getElementById('syncstate').textContent = '–†–µ–∂–∏–º: –æ–Ω–ª–∞–π–Ω (–∫–æ–º–Ω–∞—Ç–∞ '+ROOM+')';
        ref.on('value', snap => {
          const remote = snap.val();
          if(remote && JSON.stringify(remote.items) !== JSON.stringify(state.items)){
            state = remote; render(document.getElementById('q').value);
          }
        });
      }catch(e){
        console.warn('Firebase init error', e);
      }
    }
    function saveRemote(){ if(ref){ ref.set(state).catch(()=>{}); } }

    // ===== –†–µ–Ω–¥–µ—Ä =====
    const listEl = document.getElementById('list');
    const counterEl = document.getElementById('counter');
    const toastEl = document.getElementById('toast');
    const qEl = document.getElementById('q');

    let dragIndex = null;

    function render(filter=''){
      listEl.innerHTML = '';
      const norm = s => s.toLowerCase().replace('—ë','–µ');
      const f = norm(filter.trim());

      const frag = document.createDocumentFragment();
      state.items.forEach((item, idx) => {
        if(f && !norm(item.name).includes(f)) return;
        const id = 'i-'+ idx;

        const row = document.createElement('div');
        row.className = 'item';
        row.draggable = true;
        row.dataset.index = idx;

        const handle = document.createElement('span');
        handle.className = 'handle';
        handle.textContent = '‚ãÆ‚ãÆ';
        row.appendChild(handle);

        const input = document.createElement('input');
        input.type = 'checkbox';
        input.id = id;
        input.checked = !!item.checked;
        row.appendChild(input);

        const sw = document.createElement('span');
        sw.className = 'switch';
        sw.setAttribute('aria-hidden','true');
        row.appendChild(sw);

        const label = document.createElement('label');
        label.className = 'name';
        label.setAttribute('for', id);
        label.textContent = item.name;
        row.appendChild(label);

        const del = document.createElement('button');
        del.className = 'del';
        del.type = 'button';
        del.setAttribute('aria-label','–£–¥–∞–ª–∏—Ç—å');
        del.textContent = '‚úï';
        row.appendChild(del);

        // –°–æ–±—ã—Ç–∏—è
        input.addEventListener('change', () => { item.checked = input.checked; persist(); updateCounter(); });
        del.addEventListener('click', (e) => { e.stopPropagation(); state.items.splice(idx,1); persist(); render(qEl.value); showToast('–£–¥–∞–ª–µ–Ω–æ'); });

        row.addEventListener('dragstart', e => { dragIndex = idx; row.classList.add('dragging'); e.dataTransfer.effectAllowed = 'move'; });
        row.addEventListener('dragend', () => { dragIndex = null; row.classList.remove('dragging'); });
        row.addEventListener('dragover', e => { e.preventDefault(); });
        row.addEventListener('drop', e => {
          e.preventDefault();
          const to = Number(e.currentTarget.dataset.index);
          if(dragIndex===null || dragIndex===to) return;
          const [moved] = state.items.splice(dragIndex,1);
          state.items.splice(to,0,moved);
          persist();
          render(qEl.value);
        });

        frag.appendChild(row);
      });
      listEl.appendChild(frag);
      updateCounter();
    }

    function updateCounter(){
      const cnt = state.items.filter(x=>x.checked).length;
      counterEl.textContent = cnt + ' –≤—ã–±—Ä–∞–Ω–æ';
    }

    function persist(){ saveLocal(); saveRemote(); }

    // ===== –ö–Ω–æ–ø–∫–∏ =====
    document.getElementById('btn-clear').addEventListener('click', () => {
      state.items.forEach(i=>i.checked=false);
      persist();
      render(qEl.value);
    });

    document.getElementById('btn-all').addEventListener('click', () => {
      state.items.forEach(i=>i.checked=true);
      persist();
      render(qEl.value);
    });

    document.getElementById('btn-sort').addEventListener('click', () => {
      state.items.sort((a,b)=>a.name.localeCompare(b.name,'ru',{sensitivity:'base'}));
      persist();
      render(qEl.value);
      showToast('–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ê‚Üí–Ø');
    });

    document.getElementById('btn-copy').addEventListener('click', async () => {
      const text = state.items.filter(i=>i.checked).map(i=>'‚Ä¢ '+i.name).join('\n');
      try{ await navigator.clipboard.writeText(text); showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞'); }
      catch(e){ showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å :('); }
    });

    document.getElementById('btn-share').addEventListener('click', async () => {
      const items = state.items.filter(i=>i.checked).map(i=>i.name);
      const text = '–ú–æ–π —Å–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫: '+ (items.length? items.join(', '): '–Ω–∏—á–µ–≥–æ –Ω–µ –≤—ã–±—Ä–∞–Ω–æ');
      const url = location.origin + location.pathname + '?room=' + encodeURIComponent(ROOM);
      if(navigator.share){ try{ await navigator.share({title:'–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫', text, url}); } catch(e){} }
      else{ try{ await navigator.clipboard.writeText(text + '\n' + url); showToast('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ ‚Äî –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å'); } catch(e){ showToast('–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–µ —É–¥–∞–ª–æ—Å—å'); } }
    });

    document.getElementById('q').addEventListener('input', () => render(qEl.value));

    document.getElementById('add-form').addEventListener('submit', (e)=>{
      e.preventDefault();
      const input = document.getElementById('add-input');
      let name = (input.value||'').trim();
      if(name.length < 2) return;
      const existing = state.items.find(i=>i.name.toLowerCase()===name.toLowerCase());
      if(existing){ existing.checked = true; persist(); render(qEl.value); showToast('–£–∂–µ –≤ —Å–ø–∏—Å–∫–µ ‚Äî –æ—Ç–º–µ—Ç–∏–ª'); input.value=''; return; }
      state.items.push({name, checked:true});
      persist();
      input.value='';
      render(qEl.value);
      showToast('–î–æ–±–∞–≤–ª–µ–Ω–æ');
    });

    function showToast(msg){ toastEl.textContent = msg; toastEl.classList.add('show'); clearTimeout(showToast.t); showToast.t = setTimeout(()=>toastEl.classList.remove('show'), 1600); }

    // –ü–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä
    render();
  </script>
</body>
</html>

